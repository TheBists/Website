!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.blocker=t()}(this,function(){function e(e,t){void 0===t&&(t=!1);var n;if(t){n=b.window[e].tagDetails}else{var r=b.document.getElementsByClassName("adltag-id-blocking")[0];if(r){var a=null;if("function"==typeof r.getAttribute)a=r.getAttribute("data-adltag-id");else for(var o=r.attributes,i=0;i<o.length;i++)if(o[i].name&&"data-adltag-id"===o[i].name){a=o[i].name;break}var d=e in b.window?b.window:b.window.parent;n=a?d[e][a]:null}}return n}function t(e,t){var n="";try{if(t){var r=JSON.stringify(e,R),a=encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)});n=encodeURIComponent(M(a))}else n=encodeURIComponent(M(unescape(encodeURIComponent(JSON.stringify(e)))))}catch(e){n=encodeURIComponent(M('{"message": "Encoding JSON Failed", "error":"'+e.toString()+'"}'))}return n}function n(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),O.replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}function r(){return x}function a(e,t){for(var n=[],r=0,a=e.length;r<a;r+=t)n.push(e.substring(r,r+t));return n}function o(e){if(e)try{var t=e.outerHTML,n=function(e){for(var t=[],n={markup:"",scripts:[],frames:[]},r=e.getElementsByTagName("iframe"),a=0;a<r.length;a++)t.push(r[a]);for(var o=e.getElementsByTagName("script"),i=0;i<o.length;i++)n.scripts.push(o[i].outerHTML);for(;t.length>0;){var d=t.shift();try{var c=d.contentWindow.document.getElementsByTagName("html")[0].innerHTML,u=d.outerHTML.replace("</iframe>",c+"</iframe>");n.markup+=u,d.contentWindow.document.getElementsByTagName("script").forEach(function(e){n.scripts.push(e.outerHTML)});for(var l=d.contentWindow.document.getElementsByTagName("html")[0].getElementsByTagName("iframe"),s=0;s<l.length;s++)t.push(l[s])}catch(e){n.frames.push(d.outerHTML)}}return n}(e);return n.markup=t+"\x3c!-- IFRAME INNER CONTENT --\x3e"+n.markup,n}catch(e){}return""}function i(e,i,d,c,u,l){if(void 0===u&&(u=null),void 0===l&&(l=null),e!==B.Error||!d.errorReported){var s={};s.siteId=i,s.url=d.topDomain||b.window.location.href,s.adUnit=d.au,s.dfpDetails=d.dfpDetails,s.width=d.w,s.height=d.h,s.wv=d.wv,s.bv="0.0.1+707526e";var f=b.window.document.getElementsByTagName("html")[0],p=null,m=!1,w=null;switch(e){case B.Blacklist:w=o(f),s.tagMarkup=w.markup,u&&(s.blacklistData=u),s.blocked=d.blocked,m=!0,p=P;break;case B.PrePlacement:p=_;break;case B.PostPlacement:break;case B.PostPlacementTag:p=S,w=o(f),s.tagMarkup=w.markup||d.placedTagMarkup;break;case B.PotentialRedirect:p=S,w=o(f),s.tagMarkup="\x3c!--POTENTIAL_REDIRECT--\x3e\n"+(w.markup||d.placedTagMarkup);break;case B.Error:p=N,w=o(f),s.intermediateMarkup=w.markup,s.errorData=u,s.errorMethod=l,m=!0,d.errorReported=!0}if(m)try{s.callStack=(u?u.Callstack:null)||(new Error).stack}catch(e){}if(p){((function(e,o,i,d,c){var u=[],l=t(o,L),s=a(l,r());if(s.length>20){var f=c&&c.scripts?c.scripts.join("\n"):"",p=c&&c.frames?c.frames.join("\n"):"",m="<html><head></head><body>Too many requests: "+s.length+".\n"+f+"\n"+p+"</body></html>";o.intermediateMarkup?(o.intermediateMarkup=m,o.tagMarkup=""):(o.tagMarkup=m,o.intermediateMarkup=""),l=t(o,L),s=a(l,r())}var w=n();return s.forEach(function(t,n){var r="//"+i+"-"+A+e+t+"&i="+(n+1)+"-"+s.length+"&t="+d+"&r="+w+"&c="+i+"&z="+(L?1:0);u.push(r)}),u})(p,s,i,c,w)||[]).forEach(function(e){new Image(1,1).src=e})}}}function d(e){if(e.frameElement){var t=e.frameElement.height,n=e.frameElement.width;"IFRAME"===(e.parent.frameElement?e.parent.frameElement.nodeName:"")&&(e.parent.frameElement.height=t,e.parent.frameElement.width=n)}}function c(e){e.frameElement&&(e.frameElement.height=0,e.frameElement.width=0)}function u(e,t){if(void 0===t&&(t=null),e.refreshMessage)b.window.parent.postMessage(e.refreshMessage,"*");else{var n=!0;try{if(b.inSafeFrame)t&&(e.safeFrameKey=t,b.window.parent.postMessage(e,"*"),n=!1);else if(b.window.parent&&b.window.parent.googletag)for(var r=e.au,a=b.window.parent.googletag.pubads().getSlots()||[],o=function(e){var t=a[e],o=t.getAdUnitPath(),i=t.getSlotId().getId();if(r===o||r===i)return n=!1,function(e){C.forEach(function(t){e.clearTargeting(t)})}(t),b.window.parent.setTimeout(function(){b.window.parent.googletag.pubads().refresh([t])},10),"break"},i=0;i<a.length;i+=1){if("break"===o(i))break}}catch(e){}n&&b.window.document.clear()}}function l(e,t,n){void 0===n&&(n=!1);var r,a=e.adDivId;if(e.safeFrameKey){r=e.safeFrameKey}b.window.addEventListener&&b.window.addEventListener("beforeunload",function(t){if(!e.frameLoaded&&(e.reportMarkup||Math.random()<D.POTENTIAL_REDIRECT_REPORT_RATIO))try{i(B.PotentialRedirect,e.siteId,e,a)}catch(e){}});var o=function(){try{e.events.push(["window_load",Date.now()]),n||d(b.window);var o=t||e.reportMarkup,c=o?B.PostPlacementTag:B.PostPlacement,l=e;if(o&&!e.blocked){var s=b.document.getElementById(a);l.placedTagMarkup=s?s.outerHTML:b.window.document.getElementsByTagName("html")[0].outerHTML,i(c,e.siteId,l,a)}e.frameLoaded=!0,console.table,e.tryRefreshSlot&&u(e,r)}catch(t){i(B.Error,e.siteId,e,e.uniqueTagId,t,"window.load")}};if(e.events.push(["blacklist_write",Date.now()]),n)if(e.safeFrameKey&&delete e.safeFrameKey,b.inSafeFrame||e.markupInDom)b.window.addEventListener("load",o),b.document.write(""+e.tagMarkup);else{var c='<script>window.addEventListener("error", window["'+e.onPageSiteId+'"].onerror);window.addEventListener("load", window["'+e.onPageSiteId+'"].onload);delete window["'+e.onPageSiteId+'"]<\/script>';b.window[e.onPageSiteId].onload=o,b.window[e.onPageSiteId].onerror=b.window.onerror,e.tagMarkup=e.tagMarkup.replace("<html><head>","<html><head>"+c),b.document.write(e.tagMarkup)}else b.window.addEventListener("load",o),b.document.write("<div id='"+a+"'>"+e.tagMarkup+"</div>")}function s(e){try{var t="",n=b.window.parent.document;if(e.dfpSB||e.tagMarkup.indexOf("ADL_AUTO_WRAP")>=0||e.tagMarkup.indexOf("var viewReq = new Array();")<0){var r=n.createElement("div");r.innerHTML=e.tagMarkup;var a=n.cloneNode(!0),o=a.getElementsByClassName("adl-tag-wrapper")[0];o.parentNode.replaceChild(r,o),t=a.documentElement.outerHTML}else t=e.tagMarkup;"complete"!==n.readyState?n.onreadystatechange=function(){"complete"===n.readyState&&n.write(t)}:n.write(t)}catch(t){b.window.parent.document.write(e.tagMarkup)}}function f(e){var t=e+"-"+j;try{if(b.window[t])return b.window[t];if(b.window.parent&&b.window.parent[t])return b.window.parent[t]}catch(e){}return null}function p(e,t,n){void 0===n&&(n="");var r=[],a=f(e);return a&&(r.push.apply(r,a.search(t.creativeId,H.Creatives)),r.push.apply(r,a.search(t.lineitemId,H.LineItems)),r.push.apply(r,a.search(t.advertiserId,H.Advertisers)),r.push.apply(r,a.search(t.campaignId,H.Campaigns)),r.push.apply(r,a.search(n,H.Platforms))),r}function m(e){return q.some(function(t){return e.indexOf(t)>=0})}function w(e,t){var n=function(e,t){var n=(f(e)||U).search(t,H.Blacklist);if(n){var r=0,a=null,o=-1;return n.forEach(function(e){e.action>r&&(r=e.action,a=e.token),e.markupReport&&e.markupReport>o&&(o=e.markupReport)}),{action:r,actionDetails:a,reportMarkup:!0,items:n,markup:t}}return null}(e.siteId,t);if(n&&n.action){switch(e.blocked=!1,n.action){case F.AlwaysBlock:e.blocked=!0,e.tryRefreshSlot=!0;break;case F.BlockPercentage:n.actionDetails?e.blocked=Math.random()<n.actionDetails:e.blocked=!0;break;case F.RenderInSandbox:e.blocked=!0,e.siteId,n.reportMarkup}n.reportMarkup&&i(B.Blacklist,e.siteId,e,e.uniqueTagId,n)}return e.blocked}function g(e,t){if(t&&t.document){var n=t.document.getElementsByTagName("head")[0]||t.document.body||t.document.createElement("script");n&&G.forEach(function(t){try{for(var r=Object.getPrototypeOf(n);r[t]&&!Object.prototype.hasOwnProperty.call(r,t);)r=Object.getPrototypeOf(r);r&&r[t]&&("insertAdjacentElement"===t||"insertAdjacentHTML"===t?function(e,t,n){if(t&&t[n]){var r=t[n];t[n]=function(t,n){if(!e.blocked)if("object"==typeof n){if(n){var a=n.outerHTML;if(!a||!w(e,a)){var o;"IFRAME"===n.tagName&&(o=null);var i=r.apply(this,arguments);if("IFRAME"===n.tagName&&n.contentWindow)try{y(e,!0,n.contentWindow),o&&o.disconnect()}catch(e){}return i}e.blockedMarkup=a}}else{if(!w(e,n))return r.apply(this,arguments);e.blockedMarkup=n}return null}}}(e,r,t):function(e,t,n){if(t&&t[n]){var r=t[n];t[n]=function(t){if(t&&!e.blocked){var n=t.outerHTML;if(!n||!w(e,n)){var a;"IFRAME"===t.tagName&&(a=null);var o=r.apply(this,arguments);if("IFRAME"===t.tagName&&t.contentWindow)try{y(e,!0,t.contentWindow),a&&a.disconnect()}catch(e){}return o}e.blockedMarkup=n}return null}}}(e,r,t))}catch(e){}})}}function h(e,t){t.adlSavedMethods||(t.adlSavedMethods={}),W.forEach(function(n){t.adlSavedMethods[n]=t.adlSavedMethods[n]||t.document[n],function(e,t,n){t.document[n]=function(){if(!e.blocked&&t.document[n].arguments.length>0){var r=t.document[n].arguments;r&&r.length>0&&(e.intermediateMarkup=r[0]),w(e,r[0])||t.adlSavedMethods[n].apply(t.document,r)}}}(e,t,n)})}function v(e,t){try{var n=t.frameElement;if(n){var r=n.setAttribute,a=n.removeAttribute;n.setAttribute=function(){if("sandbox"===(arguments.length>0?arguments[0]:"")){var t={hostname:"sandbox",token:"set_attribute",action:F.AlwaysBlock};e.blocked=!0;var n={action:F.AlwaysBlock,actionDetails:"SANDBOX_SET_ATTRIBUTE",reportMarkup:!0,items:[t],markup:""};i(B.Blacklist,e.siteId,e,e.uniqueTagId,n)}else r.apply(this,arguments)},n.removeAttribute=function(){if("sandbox"===(arguments.length>0?arguments[0]:"")){var t={hostname:"sandbox",token:"remove_attribute",action:F.AlwaysBlock};e.blocked=!0;var n={action:F.AlwaysBlock,actionDetails:"SANDBOX_REMOVE_ATTRIBUTE",reportMarkup:!0,items:[t],markup:""};i(B.Blacklist,e.siteId,e,e.uniqueTagId,n)}else a.apply(this,arguments)},Object.defineProperty(n,"sandbox",{get:function(){return[]},set:function(){var t={hostname:"sandbox",token:"set_property",action:F.AlwaysBlock};e.blocked=!0;var n={action:F.AlwaysBlock,actionDetails:"SANDBOX_SET_PROPERTY",reportMarkup:!0,items:[t],markup:""};i(B.Blacklist,e.siteId,e,e.uniqueTagId,n)}})}}catch(e){}}function k(e,t){if(t&&t.document){var n=t.document.createElement("a");n&&z.forEach(function(t){try{for(var r=Object.getPrototypeOf(n);r[t]&&!Object.prototype.hasOwnProperty.call(r,t);)r=Object.getPrototypeOf(r);r&&r[t]&&function(e,t,n){if(t&&t[n]){var r=t[n];t[n]=function(){if("click"===n||arguments.length>0&&arguments[0]instanceof MouseEvent){var t=this.href;return t&&w(e,n+":"+t)?(u(e),null):r.apply(this,arguments)}return r.apply(this,arguments)}}}(e,r,t)}catch(e){}})}}function E(e,t,n){if(t&&t[n]){var r=t[n],a=function(e){return function(t){var n=t instanceof Element?t.outerHTML:t.toString();return!!n&&w(e,n)}}(e);t[n]=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];for(var o,i=0;i<t.length&&!o;i+=1)o=a(t[i]);return o?(u(e),null):r.apply(this,arguments)}}}function y(e,t,n){void 0===n&&(n=null);try{var r=n||b.window;t?(g(e,r),h(e,r),function(e,t){try{if(t.open){var n=t.open;t.open=function(t){return t&&w(e,"window.open:"+t)?(u(e),null):n.apply(this,arguments)}}}catch(e){}}(e,r),k(e,r),function(e,t){if(t){var n=t.document.getElementsByTagName("head")[0]||t.document.createElement("script");n&&K.forEach(function(t){try{for(var r=Object.getPrototypeOf(n);r[t]&&!Object.prototype.hasOwnProperty.call(r,t);)r=Object.getPrototypeOf(r);r&&r[t]&&E(e,r,t)}catch(e){}})}}(e,r)):function(e){e.adlSavedMethods&&W.forEach(function(t){e.document[t]=e.adlSavedMethods[t]})}(r)}catch(t){i(B.Error,e.siteId,e,e.uniqueTagId,JSON.stringify(t),"replaceDomFunctions")}}function T(e,t){e.onerror=function(e,n,r,a,o){if("object"==typeof e){n="",r=(e=e.message).lineno,a=e.columnno;o=e.error}var d={Message:e,URL:n,Line:r,Column:a,ErrorObj:o||"",Callstack:o?o.stack||"":""};return J.some(function(t){return e.indexOf(t.msg)>=0})&&(t.blocked=!0,i(B.Error,t.siteId,t,t.uniqueTagId,d,"window.onerror.sandbox")),!1}}function I(t,r,a){if(r){var o=e(t,!0);if(o){try{o.tagMarkup=r,o.onPageSiteId=t;var u=t.split("_");o.siteId=u.length>1?u[1]:u[0],o.events=[];var f=o.currentTagId.split("_"),w=f.length>2?parseInt(f[1],10):0;o.events.push(["op_wrapper_init",w]),o.events.push(["op_initialize",Date.now()]);var g=o.whitelistChecked?[]:p(o.siteId,o.dfpDetails),h=m(o.tagMarkup);if(g.length>0||h)return void b.document.write(r);o.uniqueTagId=o.currentTagId?o.currentTagId:n(),o.adDivId="adl-div-"+o.uniqueTagId,o.reportMarkup=Math.random()<D.PLACEMENT_REPORT_RATIO,o.errorReported=!1,T(b.window,o),v(o,b.window),y(o,!0,b.window)}catch(e){i(B.Error,o.siteId,o,o.uniqueTagId,e,"op_initialize")}l(o,!1,!0)}}else{b.window.frameElement&&(b.window.frameElement.scrolling="no");var k=e(t,!1);if(((b.window.location?b.window.location.hostname:b.window.origin)||"").indexOf("tpc.googlesyndication")>-1)return k.renderOriginal=!0,c(window),void s(k);if(b.window.name||(b.window.name=b.window.parent.frameElement?b.window.parent.frameElement.name:"adl-frame"),k){try{k.events=[];var E=k.currentTagId.split("_"),I=E.length>2?parseInt(E[1],10):0;k.events.push(["wrapper_init",I]),k.events.push(["initialize",Date.now()]);var M=k.whitelistChecked?[]:p(t,k.dfpDetails),R=m(k.tagMarkup);if(M.length>0||R)return k.renderOriginal=!0,c(b.window),void s(k);b.window.addEventListener("resize",function(){k.events.push(["resize",Date.now()]),d(b.window)}),function(e){e&&X.forEach(function(t){var n=e;try{for(var r=0;r<10&&(n=n.parent);r+=1){if(t in n){e.parent&&!e.parent[t]&&(e.parent[t]=n[t]);break}if(n.top===n.self)break}}catch(e){}})}(b.window),k.uniqueTagId=k.currentTagId?k.currentTagId:n(),k.siteId=t,k.adDivId="adl-div-"+k.uniqueTagId,k.errorReported=!1,T(b.window,k),v(k,b.window)}catch(e){i(B.Error,k.siteId,k,k.uniqueTagId,e,"initialize"),function(e){e&&e.parent&&X.forEach(function(t){t in e.parent&&delete e.parent[t]})}(b.window),function(e){var t="error_"+e.currentTagId;b.window[t]&&b.window[t]()}(k)}var O=Math.random()<D.TRY_LOGGING_RATIO&&a;if(!a||Y||O){k.reportMarkup=Math.random()<D.PLACEMENT_REPORT_RATIO,y(k,!0,b.window);var x=D.PLACEMENT_REPORT_RATIO/D.TRY_LOGGING_RATIO,A=O&&Math.random()<x;l(k,A,!1)}else b.window.addEventListener("load",function(){k.events.push(["window_sandbox_load",Date.now()]),d(b.window)}),k.events.push(["sandbox_write",Date.now()]),b.document.write("<div id='"+k.adDivId+"'>"+k.tagMarkup+"</div>")}}}var b={ctxtWindow:null,get window(){return this.ctxtWindow||window},set window(e){this.ctxtWindow=e},get document(){return this.window.document},get inSafeFrame(){return this.window.location.origin.indexOf("tpc.googlesyndication.com")>=0}},M="undefined"!=typeof btoa?btoa:function(e){return e},R=function(e,t){if(t instanceof Error){var n={};return Object.getOwnPropertyNames(t).forEach(function(e){n[e]=t[e]}),n}return t},O="xxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx",x=8e3,A="tagan.adlightning.com/",P="tag?d=",_="place?p=0&d=",S="place?p=1&d=",N="error?d=",L=!0,B={Blacklist:0,MarkupAccumulate:1,PrePlacement:2,PostPlacement:3,PostPlacementTag:4,Error:5,PotentialRedirect:6},D={SEND_IMPRESSIONS:!0,PLACEMENT_REPORT_RATIO:.01,TRY_LOGGING_RATIO:1,RENDER_AFTER_SANDBOX_ERROR:!1,POTENTIAL_REDIRECT_REPORT_RATIO:.01},C=["hb_pb","hb_adid","hb_bidder"],j="ADL_BLACKLIST",F={AlwaysBlock:10,BlockPercentage:9,ReRunAuction:8,ShowHouseAd:7,RenderInSandbox:2,Report:1,None:0},H={Blacklist:0,Creatives:1,LineItems:2,Advertisers:3,Campaigns:4,Platforms:5},q=["carambo.la/","a.teads.tv"],U={type:1,version:1,items:[],search:function(e,t){var n=[];if(!e)return n;var r=e.toLowerCase();return U.items.forEach(function(e){r.indexOf(e.token)>-1&&(e.paths?e.paths.forEach(function(t){if(r.indexOf(t.token)>-1){var a={hostname:e.token,token:t.token,action:t.action};n.push(a)}}):n.push(e))}),n}},W=["write","writeln"],G=["replaceChild","appendChild","insertBefore","insertAdjacentElement","insertAdjacentHTML"],z=["click","dispatchEvent"],K=["append","prepend","before","after","replaceWith"],J=[{msg:"InvalidAccessError"},{msg:"Uncaught SecurityError"},{msg:"Access is denied."}],X=["googletag","oxhbjs"],Y=!1;return function(e,t,n,r){if(void 0===r&&(r=null),b.window=r||window,!b.window.document.write)try{b.window.document.write=b.window.parent.document.write}catch(e){if(!b.window.document.writeln)return null;b.window.document.write=b.window.document.writeln}return I(e,t,n)}});
//# sourceMappingURL=blocker.js.map
